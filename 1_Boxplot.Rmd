---
title: "Boxplot - Analyse van ..."
author: "Gert Vanthournout"
date: "Gepubliceerd op `r Sys.Date()`"
output: 
  html_document: 
    highlight: zenburn
css: "css/labo.css"
---

```{r include=FALSE}
library(knitr)
library(readxl)
library(data.table)
library(magrittr)
library(dplyr)


sem_1_anon <- read_excel("dat/sem_1_anon.xlsx")
```

# Visualizing Descriptive analyses for beginners

## Load data

The data file contains the results of +- 4000 unique students who participated in the begin assessment environment at AP, called AP-Vaardig. Students could participate in assessments on 

+ Language skills 
+ Mathematics 
+ Study motivation 
+ Learning strategy use

In addition to these core-variables we obtained some background variables such as Department, Study program (Opleiding) and Program type (Professionele bachelor or graduaat). We also included students' average score on their exams in January (GPA; Grade Point Average). All variable names are in Dutch.


There are multiple ways of importing data files in R-studio. The most straightforward is using the user interface in RStudio. You can access this via _Environment > Import Dataset > From Excel..._. If you are using RStudio for the first time, the program might ask you to download and install some packages. Just agree to installing and let the installation finish.  

The data file you have to import can be found in the chat or on this location:

```
https://github.com/ddhaese/Project_PHD_DAY/tree/main/dat
```

You'll notice that RStudio wrote some code in your console.  This is the code the _Import Dataset_ wizard used to import the data file. Y can use this code to import the data in RStudio in the future, instead of using the import wizard. You can also amend this code later, for instance by adding code to define 'NA'-values:

```r
library(readxl)

sem_1_anon <- read_excel("dat/sem_1_anon.xlsx")
View(sem_1_anon)
```

The data is saved in an R-object called `sem_1_anon` en if you look under the 'Environment' tab, you should see this object appear. The last line of this code opens your data file in the RStudio viewer. For data files from a small to moderate size this is a convenient way to explore your data. You can also retrieve the 'data type' RStudio assigned to each variable by hovering over the variable name/column name. This might help you explain why RStudio is not willing to produce a certain visual (i.e. because it interpreted a numerical variable as a factor (ordinal variable)). You can get similar information by clicking open the `Environment`-tab. This is especially handy for a large data set if you want to look up how a certain variable in your set is written. A third way to consult the content of any object in R is to use the`str` function. Copy the code bellow in your console and you should see a long list of all varaibles and their data types. You also get an indication of the length of the columns and a sample with the values of the first couple of rows. Finally, you can see that this oblect is a `tibble`, a table derived from a `data.frame`. (for those who are interested: a tibble is a format that belongs to the tidyverse, a cluster of integrated R-packages aimed at tidying, wrangling, visualizing and presenting data: https://www.tidyverse.org/).

```{r view-object, output.lines = 15}
# In de console:
str(sem_1_anon)
```

Let's switch to our newly generated example Rmd-file. Delete all example code (or start bellow the code if you want to retain it for further inspection later on). For those who want to delete: everything bellow `## R Markdown` is ok. Next, make a new title: '## TODO: TITEL WIJZIGEN' followed by an empty line (## tells R-Markdown to make a title at the second level). Bellow the title, insert a code chunk. Click insert (somewhere on the top right of the window where you can view your Rmd-file). In the drop-down menu, select the _code chunk_ you want to insert: R-code in this case (actually two separate code chunks :) ). Paste the code from console in the chunks according to the example bellow: 

````md
`r ''````{r setup, include=FALSE}
library(readxl)
```
````

````md
`r ''````{r load-data}
sem_1_anon <- read_excel("dat/sem_1_anon.xlsx")
View(sem_1_anon)
```
````

_Pro tip 1:_ It is conventient to start each new document with a code chunk in which you load not only your data, but also all the packages you will use in your analyses. I personally have a list of frequently used packages I copy/paste in this chunk across all my projects. 

_Pro tip 2:_ You can see the 'notebook' taking shape here: within the R-code chunks you execute your analyses or create your visualizations. Between the chunks you can write down interpretations, intriguing results or questions for your supervisor. You can easily structure your notbook by adding titles (remember the ## title, followed by an empty line) 

you can 'print' the entire document by clikcing the 'knit' button in the menu bar in the top left corner. This wil produce a html-page including all calculations and visuals, but also the text and titles in between (so the entire notebook)


Now, let's turn to visualizing our data (finally)


## Exploring the distribution of the variable 'Woordenschat' (Vocabulary) through a histogram

As stated above: our dataset is composed of various testresults and some background variables in the columns and participating students as rows. Let's start exploring our data by visualizing some of the variables (exploratory data visualization). To get started we have to load the required packages. In R this is a two step procedure: First, you have to download the packages to your computer (via install.packages). Second you have to activate the packages in R (via library). You have to download the packages only once, but have to activate them for each session.


```r
# In de console (enkel eenmalig bij eerste gebruik):
install.packages(c("data.table", "magrittr", "tidyverse"))
```
_Pro tip 3_: We prefer not to incorporate our 'install.packages' commands in our Rmd-file. Otherwise R would download these packages every time we would run our code. That would slow down the computing time significantly.

You can paste the code bellow after previous `library`-statements.

```r
library(readxl)
library(data.table)
library(magrittr)
library(tidyverse)
```

_Pro tip 4_: I would add these to the first 'load' chunk at the top of the Rmd-file.


We will now examine the distribution of the variable  `woordenschat`. Observe how the code is constructed bellow:

* We define which colors we want to use by identifying a palette. So `col = 1` means `aliceblue` and `col = 2` indicates `black`. We can use this palette throughout the whole document if are looking for consistency in our datavisualizations. We could also add more colors to this list (e.g. all branding colors from our organization). 
* We select the variable from the `sem_1_anon` dataset by stating the dataset, followed by '$' and the variable name 
* We use a special operator mark from the package `magrittr` (`%>%`) to pass on the result to the `hist`-function (this is called _method chaining_ of _piping_). 
*'hist' is the code that creates the actual histogram. 
* We define a title and names for the X and Y-axis. 
* To the message in our graph more easily understandable, we add a vertical line at the 50% mark, using the function `abline`. 

```{r fig.width=6}

palette(c("aliceblue", "black", "blue", "red", "green", "yellow", "purple"))
# Palette defines a range of colours. you can refer to these colors by using the 'order number' in the palette statement

sem_1_anon$Woordenschat %>%
  hist(main = "Verdeling score woordenschat",
    xlab = "Score", ylab = "Aantal studenten",
    col = 1:7, )

abline(v = 50, lwd = 2, col = 2)
```

_Pro tip 5_: If you are unsure about what specific code functions mean or do, you can consult the help function. there are 3 common ways of doing this: (1) type '?' directly followed by the code (e.g. ?hist) in the console. (2) In the bottom right of your RStudio concole, you can see a tab called 'Help'. click it and write the name of the function in the search field on the top right. (3) Google the name of the function + R an you will probably come across more information than you need (Yes, R is thinkering)


## Exercise time

1. Write down an observation regarding the histogram underneath the figure in your Rmd file.
2. Consult the help file for histogram. Try changing the width of the rectangles from 10 to 5, by adapting the 'breaks' in the histogram. (Copy the code to a new chunk before you start tinkering)
3. Make the current histogram more 'disco' by adding 5 more collors based on name or HEX-code to the palette. (this will help: http://www.sthda.com/english/wiki/colors-in-r). To use the succession of colors instead of a single color, use col = 1:7 (: means 'from 1 untill 7) 
4. Make a similar histogram on the variable 'vergelijkingen1'
5. Distinguish the histograms by adding a sub-title above each histogram containing the variable-name.
6. Can you add a red, striped vertical line where the mean in the histogram of 'Vergelijkingen1' is situated? (this will help: http://www.sthda.com/english/wiki/abline-r-function-an-easy-way-to-add-straight-lines-to-a-plot-using-r-software)
7. Change the histogram for Vergelijkingen1 to a 'density plot' (check the help function for hist and look for 'freq')


## Exploring the distribution of a categorical variable (Departement) 

We will now explore how student-participation is distributed across departements in AP. For those who are really curious:

* GW = Gezondheid en Welzijn
* MC = Management en Communicatie
* OT = Onderwijs en Training
* WT = Wetenschap en Techniek
* KC = Koninklijk Conservatorium
* KA = Koninklijke Academie


Observe how the code is constructed bellow:

* We select the variable from the `sem_1_anon` dataset by stating the dataset, followed by '$' and the variable name 
* We use a special operator mark from the package `magrittr` (`%>%`) to pass on the result to the `table`-function (this is called _method chaining_ of _piping_) and so on. 
*`table` counts the number of rows pertaining to a specific value of the categorical variable `Departement` 
* `sort`organizes this count ascending.
* `rev` swiches the order to descending
* `barplot` creates the actual barplot. 


```{r}
sem_1_anon$Departement %>%
  table %>%
  sort %>%
  rev %>%
  barplot(main = "Verdeling per departement",
    xlab = "Department", ylab = "Aantal studenten",
    cex.names = .7, cex.axis = .9, col = 1)
```

We can observe that some of the departments are barely represented in our data file. If we would continue with analyses in which Departement is included as a predictor, this would hamper our power. So based on our visualizations it would be better to remove these students and continue with only 4 Departements.

We can do this by using the following steps:

* We convert our Tibble to a `data.table` object using the `setDT` function. 
* We count the number of students per departement using the function `.N`) per departement
* We selecteren those departments containing more than 5 participating students and we save the results in a new object called `dep_top`.

From now on we can use the data file `sem_1_anon`if we want to use all data and `dep_top` if we want to use the cleaned version.

```{r}
sem_1_anon <- setDT(sem_1_anon)

dep_top <- sem_1_anon[, .N, Departement][N > 5, Departement]

dep_top
```

_Pro Tip 6:_ an alternative for filtering out these teulst would be to use the `dplyr` package. It is a part of the tidyverse and specififcally aimed at data-wrangling. The code is provided as an example. Results should be identical (However, the dplyr-result will remain a tibble, not a data table)

```{r}
dep_top_alt <- sem_1_anon%>%
  filter(Departement, n>5)
```



## De boxplot

We kennen de globale verdeling van de scores voor woordenschat en we weten welke van de 4 departmenten we willen bestuderen. Nu kunnen we een boxplot uittekenen:

```{r fig.width = 6}
sem_1_anon %>% 
  filter(Departement %in% dep_top) %>% 
  boxplot(Woordenschat ~ Departement, data = .,
    col = 1, pch = 19, cex = .5,
    main = "Verdeling score woordenschat per departement")

abline(h = 50, lwd = 2, col = 2)
```

## What's next