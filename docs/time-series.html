<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Workshop 2 Time Series | Social Network</title>
  <meta name="description" content="Workshop as a part of the FSS PhD &amp; PostDoc Day event on March 18 2021" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Workshop 2 Time Series | Social Network" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Workshop as a part of the FSS PhD &amp; PostDoc Day event on March 18 2021" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Workshop 2 Time Series | Social Network" />
  
  <meta name="twitter:description" content="Workshop as a part of the FSS PhD &amp; PostDoc Day event on March 18 2021" />
  

<meta name="author" content="David D’Haese" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
<link rel="prev" href="boxplot.html"/>
<link rel="next" href="social-network.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/d3-4.5.0/d3.min.js"></script>
<script src="libs/forceNetwork-binding-0.4/forceNetwork.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/labo.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="1" data-path="boxplot.html"><a href="boxplot.html"><i class="fa fa-check"></i><b>1</b> Boxplot</a>
<ul>
<li class="chapter" data-level="1.1" data-path="boxplot.html"><a href="boxplot.html#start"><i class="fa fa-check"></i><b>1.1</b> Start</a></li>
<li class="chapter" data-level="1.2" data-path="boxplot.html"><a href="boxplot.html#nieuw-project"><i class="fa fa-check"></i><b>1.2</b> Nieuw project</a></li>
<li class="chapter" data-level="1.3" data-path="boxplot.html"><a href="boxplot.html#nieuw-rapport"><i class="fa fa-check"></i><b>1.3</b> Nieuw rapport</a></li>
<li class="chapter" data-level="1.4" data-path="boxplot.html"><a href="boxplot.html#data-opladen"><i class="fa fa-check"></i><b>1.4</b> Data opladen</a></li>
<li class="chapter" data-level="1.5" data-path="boxplot.html"><a href="boxplot.html#woordenschat"><i class="fa fa-check"></i><b>1.5</b> Woordenschat</a></li>
<li class="chapter" data-level="1.6" data-path="boxplot.html"><a href="boxplot.html#departement"><i class="fa fa-check"></i><b>1.6</b> Departement</a></li>
<li class="chapter" data-level="1.7" data-path="boxplot.html"><a href="boxplot.html#de-boxplot"><i class="fa fa-check"></i><b>1.7</b> De boxplot</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>2</b> Time Series</a>
<ul>
<li class="chapter" data-level="2.1" data-path="time-series.html"><a href="time-series.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="time-series.html"><a href="time-series.html#start-1"><i class="fa fa-check"></i><b>2.2</b> Start</a></li>
<li class="chapter" data-level="2.3" data-path="time-series.html"><a href="time-series.html#new-project"><i class="fa fa-check"></i><b>2.3</b> New project</a></li>
<li class="chapter" data-level="2.4" data-path="time-series.html"><a href="time-series.html#new-rmarkdown-report"><i class="fa fa-check"></i><b>2.4</b> New RMarkdown report</a></li>
<li class="chapter" data-level="2.5" data-path="time-series.html"><a href="time-series.html#uploading-the-data"><i class="fa fa-check"></i><b>2.5</b> Uploading the data</a></li>
<li class="chapter" data-level="2.6" data-path="time-series.html"><a href="time-series.html#colors"><i class="fa fa-check"></i><b>2.6</b> Colors</a></li>
<li class="chapter" data-level="2.7" data-path="time-series.html"><a href="time-series.html#data-exploration"><i class="fa fa-check"></i><b>2.7</b> Data exploration</a></li>
<li class="chapter" data-level="2.8" data-path="time-series.html"><a href="time-series.html#prepare-data"><i class="fa fa-check"></i><b>2.8</b> Prepare data</a></li>
<li class="chapter" data-level="2.9" data-path="time-series.html"><a href="time-series.html#graphing-time-series"><i class="fa fa-check"></i><b>2.9</b> Graphing time series</a></li>
<li class="chapter" data-level="2.10" data-path="time-series.html"><a href="time-series.html#time-series-analyzes"><i class="fa fa-check"></i><b>2.10</b> Time series analyzes</a></li>
<li class="chapter" data-level="2.11" data-path="time-series.html"><a href="time-series.html#decompose-time-series"><i class="fa fa-check"></i><b>2.11</b> Decompose time series</a></li>
<li class="chapter" data-level="2.12" data-path="time-series.html"><a href="time-series.html#predictions"><i class="fa fa-check"></i><b>2.12</b> Predictions</a></li>
<li class="chapter" data-level="2.13" data-path="time-series.html"><a href="time-series.html#extra-resampling-temporal-data"><i class="fa fa-check"></i><b>2.13</b> Extra: Resampling temporal data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="social-network.html"><a href="social-network.html"><i class="fa fa-check"></i><b>3</b> Social network</a>
<ul>
<li class="chapter" data-level="3.1" data-path="social-network.html"><a href="social-network.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="social-network.html"><a href="social-network.html#loading-the-data"><i class="fa fa-check"></i><b>3.2</b> Loading the data</a></li>
<li class="chapter" data-level="3.3" data-path="social-network.html"><a href="social-network.html#exploring"><i class="fa fa-check"></i><b>3.3</b> Exploring</a></li>
<li class="chapter" data-level="3.4" data-path="social-network.html"><a href="social-network.html#reducing-size"><i class="fa fa-check"></i><b>3.4</b> Reducing size</a></li>
<li class="chapter" data-level="3.5" data-path="social-network.html"><a href="social-network.html#the-network"><i class="fa fa-check"></i><b>3.5</b> The network</a></li>
<li class="chapter" data-level="3.6" data-path="social-network.html"><a href="social-network.html#vectors"><i class="fa fa-check"></i><b>3.6</b> Vectors</a></li>
<li class="chapter" data-level="3.7" data-path="social-network.html"><a href="social-network.html#cascading-style-sheets"><i class="fa fa-check"></i><b>3.7</b> Cascading style sheets</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Social Network</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="time-series" class="section level1" number="2">
<h1><span class="header-section-number">Workshop 2</span> Time Series</h1>
<div class="figure">
<img src="img/ts.png" alt="" />
<p class="caption">Time series</p>
</div>
<div id="introduction" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Introduction</h2>
<p>In this workshop we will learn how to handle and visualize temporal data. Most analytic tools dealing with time series depend on the <code>ts</code> class of objects and so we will have to learn how to transform our source data to a <code>ts</code> object. Finally, we will be plotting the results of some diagnostic and predictive analyses typical for time series data.</p>
</div>
<div id="start-1" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Start</h2>
<ol style="list-style-type: decimal">
<li>In case you haven’t done this before, install the latest version of <a href="https://cran.r-project.org/bin/windows/base/">R</a> and <a href="https://rstudio.com/products/rstudio/download/">RStudio</a></li>
</ol>
</div>
<div id="new-project" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> New project</h2>
<p>You can do without but it is considered good practice to define a project folder and corresponding R project, no matter how small the project. On the top of the screen in RStudio you will find the button to allow you create a new project or quickly switch between projects.</p>
<ol style="list-style-type: decimal">
<li>Follow the RStudio wizard to create a new project in a folder of your choice (best locally during workshop)</li>
</ol>
</div>
<div id="new-rmarkdown-report" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> New RMarkdown report</h2>
<p>By default data scientists work with notebooks and for R this means RMarkdown notebook (<code>.rmd</code> extension). Not only do notebooks offer enhanced reproducibility. Once you get used to them, you will find them increasing your productivity:</p>
<ol style="list-style-type: decimal">
<li>Make a new rMarkdown file through <em>New File &gt; R Markdown</em></li>
<li>Give your HTML document a title (HTML is the default doc type but there are many more)</li>
<li>If your RStudio asks for it, let it install the necessary packages</li>
<li>You will notice that RStudio has made an example file for you</li>
<li>Use the <em>Save</em>-button or <code>Ctrl + S</code> to save it in the root of your project folder (b.t.w., use <code>Alt + Shift + K</code> for an overview of available shortcuts)</li>
<li>Let us immediate test the parsing of the report. <em>Run</em> or <em>knit</em> it by pressing the knit-button or use the shortcut <code>Ctrl + Shift K</code></li>
</ol>
<p>If all goes well, you should see the example report appearing in the viewer pane of your RStudio.</p>
</div>
<div id="uploading-the-data" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Uploading the data</h2>
<p>At the end of the workshop you will have the opportunity to work with the same dataset as for the Boxplot workshop, but because that data is slightly more difficult to use for time series analysis, we will first start with a simpler dataset.</p>
<p>On <a href="https://www.kaggle.com">Kaggle</a> you will find the dataset called [Time Series Data] (<a href="https://www.kaggle.com/yugagrawal95/timeseries-data" class="uri">https://www.kaggle.com/yugagrawal95/timeseries-data</a>). The data is originally made available as an Excel workbook, but we will be using the same data converted into a <code>tsv</code> file. This dataset consists of the sales figures of a number of products along with several other variables that will not be used here.</p>
<blockquote>
<p>Excel is often very problematic as a data source, so if you can avoid it, preferably use a format that will still be understood 2000 years from now: plain text, preferably tab-separated values (<code>.tsv</code>) so that values with commas need not to be escaped with double quotes.</p>
</blockquote>
<p>We use <code>data.table</code> to upload the data. This package currently offers the most professional way to manipulate data. The <code>fread</code> method is flexible and allows you to:</p>
<ul>
<li>load very fast and very large datasets</li>
<li>parse text directly as data (i.e. <code>fread ("A,B\n1,2\n3,4")</code>)</li>
<li>select variables as well as instances</li>
<li>run a shell command to add a pre-processing step</li>
<li>set the data type the variables should be interpreted as</li>
<li>include the character encoding of a file (i.e. <code>UTF-8</code>)</li>
<li>define the primary key in case of relational data</li>
<li>directly open data from within an archive (i.e. <code>fread ("dev.gz")</code>)</li>
</ul>
<ol style="list-style-type: decimal">
<li>In your new Rmd file, delete the sample code and add the code below:</li>
</ol>
<pre class="rmd"><code>---
title: &quot;Timeseries&quot;
author: &quot;Your name here&quot;
date: &quot;Published on 2021-03-16&quot;
output: 
  html_document: 
    highlight: zenburn
---
   
## Workshop Time Series
   
...</code></pre>
<ol style="list-style-type: decimal">
<li>Enter in your name and replace <code>...</code> with a new R code block (eng: <em>code chunk</em>) using the shortcut <code>Ctrl + Alt + I</code></li>
<li>Make sure in a rMArkdown file to add an empty line before and after each code block, title and list</li>
<li>Add the code below in this block (additional info to come):</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="time-series.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb15-2"><a href="time-series.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb15-3"><a href="time-series.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb15-4"><a href="time-series.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb15-5"><a href="time-series.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb15-6"><a href="time-series.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISOweek)</span>
<span id="cb15-7"><a href="time-series.html#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb15-8"><a href="time-series.html#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb15-9"><a href="time-series.html#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="time-series.html#cb15-10" aria-hidden="true" tabindex="-1"></a>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-11"><a href="time-series.html#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="time-series.html#cb15-12" aria-hidden="true" tabindex="-1"></a>sales <span class="ot">&lt;-</span> <span class="fu">fread</span>(, <span class="st">&quot;dat/sales.tsv&quot;</span>)</span></code></pre></div>
<p>With the various <code>library</code> expressions, the necessary packages are loaded into memory. If these lines generate an error, it is usually means the package needs installing first. If so, use an expression such as <code>install.packages (c (" data.atble "," magrittr "))</code> in the console to install the missing packages. Let us now briefly review why we need these packages:</p>
<ul>
<li><code>knitr</code>: parsing the RMarkdown to an HTML report</li>
<li><code>data.table</code>: loading and manipulating data</li>
<li><code>magrittr</code>: using [method chaining] (<a href="https://en.wikipedia.org/wiki/Method_chaining#" class="uri">https://en.wikipedia.org/wiki/Method_chaining#</a>:~:text=Method%20chaining%2C%20also%20known%20as,to%20store%20the%20intermediate % 20results.)</li>
<li><code>dplyr</code>: alternative to manipulating data</li>
<li><code>ISOweek</code>: converting from date to week numbers and vice versa, according to [ISO 8601] (<a href="https://en.wikipedia.org/wiki/ISO_8601" class="uri">https://en.wikipedia.org/wiki/ISO_8601</a>) standards</li>
<li><code>lubridate</code>: expression of a date as a decimal number</li>
<li><code>forecast</code>: wrapper to run forecasts on<code>ts</code> objects</li>
</ul>
<p>Note that for demo purposes two alternatives are used here for manipulating data. Also note that a lot of effort is put into manipulating date fields. As we will see, handling dates, especially when the data is classified on a weekly basis, can become very complex very rapidly.</p>
<p>With the <code>opts_chunk$set</code> function (actually function <code>set</code> that is an element of the <code>list</code> <code>opts_chunk</code>) we ensure that the source code is shown in the report. If the report is distributed to individuals who are not interested in the code, you can set <code>echo = FALSE</code>.</p>
</div>
<div id="colors" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Colors</h2>
<ol style="list-style-type: decimal">
<li>Create a color palette:</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="time-series.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">palette</span>(<span class="fu">c</span>(<span class="fu">rgb</span>(.<span class="dv">7</span>, .<span class="dv">7</span>, .<span class="dv">7</span>), <span class="st">&quot;steelblue1&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;#D3EAF1&quot;</span>))</span></code></pre></div>
<p>The above code demonstrates the use of the color palette. Here you see that you can enter colors in different formats. After the palette has been defined, you can refer to the colors by means of their indices 1, 2, &amp; hellip ;.</p>
<p>If you haven’t yet heard about it, you might want to examine the <a href="https://en.wikipedia.org/wiki/Munsell_color_system">Munsell color space</a>. Munsell was a genius with colors. A full description of his color space is beyond the scope of this workshop, but why not admire one of his so-called color contrasts (dyads):</p>
<div class="figure"><span id="fig:munsell"></span>
<img src="img/Dyad_5B-5YR_Annot.png" alt="The dyad blue-5 versus yellow-red-5 (5B-5YR). In each colored box you will see from the top down: an index for reference, the Munsell color code, the corresponding RGB values and finally the color represented as a hex triplet. See the [Wikipedia page] (https://en.wikipedia.org/wiki/Munsell_color_system) for more info and [this page] (https://www.rit.edu/cos/colorscience/rc_munsell_renotation.php) of the Rochester Institute of Technology where you will find datasets to produce similar figures." width="100%" />
<p class="caption">
Figuur 2.1: The dyad blue-5 versus yellow-red-5 (5B-5YR). In each colored box you will see from the top down: an index for reference, the Munsell color code, the corresponding RGB values and finally the color represented as a hex triplet. See the [Wikipedia page] (<a href="https://en.wikipedia.org/wiki/Munsell_color_system" class="uri">https://en.wikipedia.org/wiki/Munsell_color_system</a>) for more info and [this page] (<a href="https://www.rit.edu/cos/colorscience/rc_munsell_renotation.php" class="uri">https://www.rit.edu/cos/colorscience/rc_munsell_renotation.php</a>) of the Rochester Institute of Technology where you will find datasets to produce similar figures.
</p>
</div>

</div>
<div id="data-exploration" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Data exploration</h2>
<p>We are going to keep data exploration here to a minimum.</p>
<ol style="list-style-type: decimal">
<li>With the <code>str</code> function you can ‘look inside’ objects such as this <code>sales object</code>. Such a function is typically executed in the console and is not part of the report itself:</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="time-series.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In the console...</span></span>
<span id="cb17-2"><a href="time-series.html#cb17-2" aria-hidden="true" tabindex="-1"></a>sales <span class="sc">%&gt;%</span> str</span></code></pre></div>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   935 obs. of  86 variables:
##  $ Key                                              : chr  &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; ...
##  $ Date                                             : POSIXct, format: &quot;2014-01-01&quot; &quot;2014-01-01&quot; ...
##  $ Volume                                           : num  1346974 677826 1210359 436761 434 ...
##  $ Disc                                             : num  4.29e+08 1.16e+08 1.04e+08 5.63e+07 2.94e+05 ...
##  $ max_T                                            : num  49.5 49.5 49.5 49.5 49.5 ...
##  $ min_T                                            : num  29.7 29.7 29.7 29.7 29.7 ...
##  $ avg_T                                            : num  39.6 39.6 39.6 39.6 39.6 ...
##  $ precipitation                                    : num  0.448 0.448 0.448 0.448 0.448 ...
##  $ Consumer_Price_Index_month                       : num  85.5 85.5 85.5 85.5 85.5 ...
##  $ Exchange_Rate_Index_Period_Average_month         : num  109 109 109 109 109 ...
##  $ Exchange_Rate_LCU_per_US_Period_Average_month    : num  6.83 6.83 6.83 6.83 6.83 ...
...</code></pre>
<p>We see that there are a number of products (under <code>Key</code>), a date of sale (<code>Date</code>) and sales <code>Volume</code>. As you can see there are many more variables, but with these three we should be able to get started to demonstrate the basics.</p>
</div>
<div id="prepare-data" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Prepare data</h2>
<p>The particular thing about time series (but also, for example, GIS data) is that the dependent variables do not only depend on other variables, but also on themselves. We speak of <em>autocorrelation</em> when a value depends on a neighbouring value either through space or time.</p>
<ol style="list-style-type: decimal">
<li>To conduct a time series in R, you are best to work with <code>ts</code> class objects (stands for <em>time series</em>). In order to do that, we first need to pivot the data:</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="time-series.html#cb19-1" aria-hidden="true" tabindex="-1"></a>sales <span class="ot">&lt;-</span> sales <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="time-series.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dcast</span>(Date <span class="sc">~</span> Key, <span class="at">value.var =</span> <span class="st">&quot;Volume&quot;</span>)</span></code></pre></div>
<div class="table-wrapper">
<table>
<colgroup>
<col width="10%" />
<col width="7%" />
<col width="8%" />
<col width="9%" />
<col width="8%" />
<col width="7%" />
<col width="9%" />
<col width="9%" />
<col width="8%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Date</th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">D</th>
<th align="right">E</th>
<th align="right">F</th>
<th align="right">G</th>
<th align="right">H</th>
<th align="right">I</th>
<th align="right">J</th>
<th align="right">K</th>
<th align="right">L</th>
<th align="right">M</th>
<th align="right">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2014-01-01</td>
<td align="right">1346974</td>
<td align="right">677825.9</td>
<td align="right">1210358.5</td>
<td align="right">436760.7</td>
<td align="right">433.99</td>
<td align="right">1229415.4</td>
<td align="right">790802.1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">2014-02-01</td>
<td align="right">1058681</td>
<td align="right">442605.0</td>
<td align="right">829241.9</td>
<td align="right">205538.3</td>
<td align="right">699.10</td>
<td align="right">885082.1</td>
<td align="right">507910.2</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">2014-03-01</td>
<td align="right">1089615</td>
<td align="right">550634.4</td>
<td align="right">1100553.1</td>
<td align="right">262253.8</td>
<td align="right">1421.69</td>
<td align="right">1191730.8</td>
<td align="right">612966.6</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">2014-04-01</td>
<td align="right">1073261</td>
<td align="right">665210.9</td>
<td align="right">1316461.4</td>
<td align="right">351818.4</td>
<td align="right">1758.77</td>
<td align="right">1357049.5</td>
<td align="right">879226.3</td>
<td align="right">278106.2</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">2014-05-01</td>
<td align="right">1289022</td>
<td align="right">811401.7</td>
<td align="right">1515828.5</td>
<td align="right">309505.0</td>
<td align="right">2275.23</td>
<td align="right">1713073.1</td>
<td align="right">1041092.3</td>
<td align="right">389241.8</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">2014-06-01</td>
<td align="right">1491953</td>
<td align="right">915308.1</td>
<td align="right">1731305.7</td>
<td align="right">339498.8</td>
<td align="right">2894.75</td>
<td align="right">1887919.4</td>
<td align="right">1292278.0</td>
<td align="right">501514.3</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</div>
<p>This pivoting is rather exceptional in statistical analyses and is mainly encountered in autocorrelated data (see also the term <em>repeated measures</em>).</p>
<ol style="list-style-type: decimal">
<li>Now we select three products and also apply a <code>Date</code> filter because some values are missing at the end of the time series. Then we convert the data to a <code>ts</code> object:</li>
</ol>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="time-series.html#cb20-1" aria-hidden="true" tabindex="-1"></a>sales_ts <span class="ot">&lt;-</span> sales[</span>
<span id="cb20-2"><a href="time-series.html#cb20-2" aria-hidden="true" tabindex="-1"></a>  Date <span class="sc">&lt;</span> <span class="st">&quot;2020-02-01&quot;</span>,    <span class="co"># Filter by date</span></span>
<span id="cb20-3"><a href="time-series.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  .(A, C, E)] <span class="sc">%&gt;%</span>         <span class="co"># Selecte features</span></span>
<span id="cb20-4"><a href="time-series.html#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ts</span>(<span class="at">frequency =</span> <span class="dv">12</span>,    <span class="co"># Convert to ts, 12 months per year</span></span>
<span id="cb20-5"><a href="time-series.html#cb20-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2014</span>, <span class="dv">1</span>)) <span class="co"># Provide start of the time series</span></span></code></pre></div>
</div>
<div id="graphing-time-series" class="section level2" number="2.9">
<h2><span class="header-section-number">2.9</span> Graphing time series</h2>
<ol style="list-style-type: decimal">
<li>Once everything is in the correct format, it is as simple as calling the <code>plot</code> function:</li>
</ol>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="time-series.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>, <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb21-2"><a href="time-series.html#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="time-series.html#cb21-3" aria-hidden="true" tabindex="-1"></a>main <span class="ot">&lt;-</span> <span class="st">&quot;Sales figures</span><span class="sc">\n</span><span class="st">for three products&quot;</span></span>
<span id="cb21-4"><a href="time-series.html#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="time-series.html#cb21-5" aria-hidden="true" tabindex="-1"></a>sales_ts <span class="sc">%&gt;%</span> <span class="fu">plot</span>(<span class="at">main =</span> main, <span class="at">xlab =</span> <span class="st">&quot;Year&quot;</span>)</span></code></pre></div>
<p><img src="img/gen-sales-plot-01-1.png" width="672" /></p>
<p>Close, but no cigar. There is still an issue with the y-axes. The position of the labels on the axes in <code>base</code> R is determined by a function<code>pretty</code>. So you could turn off the y-axes in the plot (<code>yaxt = "n"</code>) and plot them all manually using the <code>axis</code> function. Of course, it is much easier to divide the numbers by a factor 1000.</p>
<ol style="list-style-type: decimal">
<li>Adjust the previous code to divide the sales figures by 1000 and than adjust the title of the figure:</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="time-series.html#cb22-1" aria-hidden="true" tabindex="-1"></a>sales_ts_th <span class="ot">&lt;-</span> sales_ts <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb22-2"><a href="time-series.html#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="time-series.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>, <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb22-4"><a href="time-series.html#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="time-series.html#cb22-5" aria-hidden="true" tabindex="-1"></a>main <span class="ot">&lt;-</span> <span class="st">&quot;Sales figures (x1000)</span><span class="sc">\n</span><span class="st">for three products&quot;</span></span>
<span id="cb22-6"><a href="time-series.html#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="time-series.html#cb22-7" aria-hidden="true" tabindex="-1"></a>sales_ts_th <span class="sc">%&gt;%</span> <span class="fu">plot</span>(<span class="at">main =</span> main, <span class="at">xlab =</span> <span class="st">&quot;Year&quot;</span>)</span></code></pre></div>
<p><img src="img/gen-sales-plot-02-1.png" width="672" /></p>
</div>
<div id="time-series-analyzes" class="section level2" number="2.10">
<h2><span class="header-section-number">2.10</span> Time series analyzes</h2>
<p>This is not a workshop on analyses, but in reality the analyses and the visualization go hand-in-hand. After all, visualization often serves as a diagnostics tool. Let us measure the amount of cross-correlation among the sales of our three selected products.</p>
<ol style="list-style-type: decimal">
<li>Examine the auto- and cross-correlation for all combinations of the sales volumes for the products A, c and E. Do this for a <em>horizon</em> of 18 months in the future (positive) and in the past (negative):</li>
</ol>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="time-series.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>)</span>
<span id="cb23-2"><a href="time-series.html#cb23-2" aria-hidden="true" tabindex="-1"></a>sales_ts_th <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">lag.max =</span> <span class="dv">18</span>)</span></code></pre></div>
<p><img src="img/gen-sales-plot-03-1.png" width="672" /></p>
<p>From this we learn, for example, that there is a correlation between products A and E with a horizon of 1 ‘season’ (1 year in this case), but that the relationship is not completely symmetrical. In other words one event seems to preceed the other and that may be en important hint to analyse possible causal dependencies. To see this, compare the correlation at 1.0 for <em>A &amp; E</em> (below the dashed blue line indicating the significance level) with that of -1.0 for <em>E &amp; A</em> (above significance level).</p>
</div>
<div id="decompose-time-series" class="section level2" number="2.11">
<h2><span class="header-section-number">2.11</span> Decompose time series</h2>
<ol style="list-style-type: decimal">
<li>Let’s break the sales figures for one product, namely product C, into a seasonal effect (the purely repetitive part), the trend (background level) and the residual noise:</li>
</ol>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="time-series.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>)</span>
<span id="cb24-2"><a href="time-series.html#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="time-series.html#cb24-3" aria-hidden="true" tabindex="-1"></a>sales_ts_th[, <span class="st">&quot;C&quot;</span>] <span class="sc">%&gt;%</span> <span class="fu">stl</span>(<span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span>) <span class="sc">%&gt;%</span> plot</span></code></pre></div>
<p><img src="img/gen-sales-plot-04-1.png" width="672" /></p>
<p>Note that the problem of the axes is solved here by alternating the position of the y-axis.</p>
<ol style="list-style-type: decimal">
<li>Investigate how the plot of a <code>stl</code> object causes the axes to be displayed alternately:</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="time-series.html#cb25-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">:::</span>plot.stl</span></code></pre></div>
</div>
<div id="predictions" class="section level2" number="2.12">
<h2><span class="header-section-number">2.12</span> Predictions</h2>
<p>Let us predict the future, more specifically the sales figures for the year 2019. Note that we just have those figures, why would we predict them? Because it is of course good to immediately test the prediction against reality, otherwise we have to wait a year and the organizers of this workshop voted against :-)</p>
<ol style="list-style-type: decimal">
<li>Let us take the standard plot for multivariate <code>forecast</code> objects:</li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="time-series.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>)</span>
<span id="cb26-2"><a href="time-series.html#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="time-series.html#cb26-3" aria-hidden="true" tabindex="-1"></a>sales_ts_th <span class="sc">%&gt;%</span> forecast <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="time-series.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">col =</span> <span class="dv">3</span>, <span class="at">xlab =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb26-5"><a href="time-series.html#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Items sold (x 1000)&quot;</span>)</span></code></pre></div>
<p><img src="img/gen-sales-forecast-1.png" width="672" /></p>
<p>This is already quite good, but there are some problems. Let’s start with an important detail: the color and shades of the prediction intervals.</p>
<ol style="list-style-type: decimal">
<li>With <code>fan</code> you can obtain more color shades and with<code>colorRampPalette</code> we make a simple color shade:</li>
</ol>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="time-series.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>)</span>
<span id="cb27-2"><a href="time-series.html#cb27-2" aria-hidden="true" tabindex="-1"></a>ramp <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)(<span class="dv">25</span>) </span>
<span id="cb27-3"><a href="time-series.html#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="time-series.html#cb27-4" aria-hidden="true" tabindex="-1"></a>sales_ts_th <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="time-series.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">fan =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a href="time-series.html#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">col =</span> <span class="dv">3</span>, <span class="at">xlab =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">shadecols =</span> ramp,</span>
<span id="cb27-7"><a href="time-series.html#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Items sold (x 1000)&quot;</span>)</span></code></pre></div>
<p><img src="img/gen-sales-forecast-color-1.png" width="672" /></p>
<p>Now comes the main problem: we really only want to forecast only 2019 and we want to see the current and forecast data superposed. It would also be nice if there were a clear marking at the start of the prediction.</p>
<ol style="list-style-type: decimal">
<li>Try to reproduce the predictions with the above requirements:</li>
</ol>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="time-series.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>, <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb28-2"><a href="time-series.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">2</span>))</span>
<span id="cb28-3"><a href="time-series.html#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="time-series.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(series_name <span class="cf">in</span> sales_ts <span class="sc">%&gt;%</span> colnames) {</span>
<span id="cb28-5"><a href="time-series.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  series <span class="ot">&lt;-</span> sales_ts_th[, series_name]</span>
<span id="cb28-6"><a href="time-series.html#cb28-6" aria-hidden="true" tabindex="-1"></a>  fc <span class="ot">&lt;-</span> series <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="time-series.html#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">window</span>(<span class="at">end=</span><span class="fu">c</span>(<span class="dv">2019</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="time-series.html#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">forecast</span>(<span class="at">fan =</span> <span class="cn">TRUE</span>, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb28-9"><a href="time-series.html#cb28-9" aria-hidden="true" tabindex="-1"></a>  fc <span class="sc">%&gt;%</span> <span class="fu">plot</span>(<span class="at">shadecols =</span> ramp, <span class="at">col =</span> <span class="dv">3</span>,</span>
<span id="cb28-10"><a href="time-series.html#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb28-11"><a href="time-series.html#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">title</span>(<span class="at">ylab =</span> series_name)</span>
<span id="cb28-12"><a href="time-series.html#cb28-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-13"><a href="time-series.html#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (series_name <span class="sc">==</span> <span class="st">&quot;E&quot;</span>) {</span>
<span id="cb28-14"><a href="time-series.html#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="dv">1</span>)</span>
<span id="cb28-15"><a href="time-series.html#cb28-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-16"><a href="time-series.html#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">2019</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb28-17"><a href="time-series.html#cb28-17" aria-hidden="true" tabindex="-1"></a>  fc <span class="ot">&lt;-</span> series <span class="sc">%&gt;%</span></span>
<span id="cb28-18"><a href="time-series.html#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">window</span>(<span class="at">start=</span><span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">12</span>)) <span class="sc">%&gt;%</span> <span class="fu">lines</span>(<span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb28-19"><a href="time-series.html#cb28-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-20"><a href="time-series.html#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="time-series.html#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">xlab =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">outer =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="img/gen-sales-final-1.png" width="672" /></p>
</div>
<div id="extra-resampling-temporal-data" class="section level2" number="2.13">
<h2><span class="header-section-number">2.13</span> Extra: Resampling temporal data</h2>
<p>Temporal data is often organized on a week, month, quarter, or annual basis. For example sales figures per quarter. In the industry we speak of a <em>bucket</em> and the bucket could be a week, a quarter, etc &amp; hellip ;. Sometimes, however, as with the student data, a date field is provided, but the data is not neatly aggregated into fixed time units. The aggregation, which is also called <em>resampling</em> or <em>bucketising</em>, must then be performed manually. This is demonstrated below for the sake of completeness.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="time-series.html#cb29-1" aria-hidden="true" tabindex="-1"></a>sem_1 <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;dat/sem_1_anon.tsv&quot;</span>)</span></code></pre></div>
<p>We first check the range of the variable <code>Date1</code>, divide it into weeks and add seven days to the end date:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="time-series.html#cb30-1" aria-hidden="true" tabindex="-1"></a>sem_1<span class="sc">$</span>Datum1 <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="time-series.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">range</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="time-series.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strftime</span>(<span class="st">&quot;%Y-W%V-1&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="time-series.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  ISOweek2date <span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="time-series.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7</span>))</span></code></pre></div>
<p>By alternating the dot color per week, we can investigate where there is sufficient data available to perform an analysis on:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="time-series.html#cb31-1" aria-hidden="true" tabindex="-1"></a>sem_1[, Week_T <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(<span class="fu">ISOweek</span>(Datum1))]</span>
<span id="cb31-2"><a href="time-series.html#cb31-2" aria-hidden="true" tabindex="-1"></a>week_lev_all <span class="ot">&lt;-</span> sem_1<span class="sc">$</span>Week_T <span class="sc">%&gt;%</span> levels</span>
<span id="cb31-3"><a href="time-series.html#cb31-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb31-4"><a href="time-series.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>)</span>
<span id="cb31-5"><a href="time-series.html#cb31-5" aria-hidden="true" tabindex="-1"></a>ramp <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="dv">24</span>, <span class="dv">1</span>)</span>
<span id="cb31-6"><a href="time-series.html#cb31-6" aria-hidden="true" tabindex="-1"></a>temp_pal <span class="ot">&lt;-</span> <span class="fu">palette</span>(ramp)</span>
<span id="cb31-7"><a href="time-series.html#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="time-series.html#cb31-8" aria-hidden="true" tabindex="-1"></a>sem_1[, <span class="fu">plot</span>(Datum1, MemoS_T, <span class="at">col =</span> Week_T,</span>
<span id="cb31-9"><a href="time-series.html#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> .<span class="dv">7</span>,</span>
<span id="cb31-10"><a href="time-series.html#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Highlight weeks&quot;</span>,</span>
<span id="cb31-11"><a href="time-series.html#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Date for review version</span><span class="sc">\n</span><span class="st">(&#39;terugblikversie&#39;)&quot;</span>,</span>
<span id="cb31-12"><a href="time-series.html#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Memorising&quot;</span>)] <span class="ot">-&gt;</span> d</span>
<span id="cb31-13"><a href="time-series.html#cb31-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb31-14"><a href="time-series.html#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> week_lev_all, <span class="at">col =</span> ramp,</span>
<span id="cb31-15"><a href="time-series.html#cb31-15" aria-hidden="true" tabindex="-1"></a> <span class="at">cex =</span> .<span class="dv">7</span>, <span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">border =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="img/gen-herb-03-1.png" width="672" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="time-series.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">palette</span>(temp_pal)</span></code></pre></div>
<p>Finally we can select the portion with suffcient data availble and convert to a <code>ts</code> object:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="time-series.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>)</span>
<span id="cb33-2"><a href="time-series.html#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="time-series.html#cb33-3" aria-hidden="true" tabindex="-1"></a>sem_1[</span>
<span id="cb33-4"><a href="time-series.html#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">&quot;2020&quot;</span>, Week_T),        <span class="co"># Selectie</span></span>
<span id="cb33-5"><a href="time-series.html#cb33-5" aria-hidden="true" tabindex="-1"></a>  .(<span class="at">MemoS_T =</span> <span class="fu">mean</span>(MemoS_T)),   <span class="co"># Var-manipulatie</span></span>
<span id="cb33-6"><a href="time-series.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  Week_T] <span class="sc">%&gt;%</span>                   <span class="co"># Groepering</span></span>
<span id="cb33-7"><a href="time-series.html#cb33-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(Week_T) <span class="sc">%&gt;%</span>          <span class="co"># dplyr</span></span>
<span id="cb33-8"><a href="time-series.html#cb33-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(MemoS_T) <span class="sc">%&gt;%</span> </span>
<span id="cb33-9"><a href="time-series.html#cb33-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ts</span>(</span>
<span id="cb33-10"><a href="time-series.html#cb33-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq =</span> <span class="fl">365.25</span><span class="sc">/</span><span class="dv">7</span>,</span>
<span id="cb33-11"><a href="time-series.html#cb33-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">start =</span> <span class="fu">decimal_date</span>(<span class="fu">ymd</span>(<span class="st">&quot;2020-09-07&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb33-12"><a href="time-series.html#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">&quot;Tijd (decimaal)&quot;</span>,</span>
<span id="cb33-13"><a href="time-series.html#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;Memoriseren&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Evolutie memoriseren&quot;</span>)</span></code></pre></div>
<p><img src="img/gen-herb-04-1.png" width="672" /></p>
<hr />

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="boxplot.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="social-network.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
