<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Workshop 2 Tijdreeksen | Tijdreeksen</title>
  <meta name="description" content="Workshop as a part of the FSS PhD &amp; PostDoc Day event on March 18 2021" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Workshop 2 Tijdreeksen | Tijdreeksen" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Workshop as a part of the FSS PhD &amp; PostDoc Day event on March 18 2021" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Workshop 2 Tijdreeksen | Tijdreeksen" />
  
  <meta name="twitter:description" content="Workshop as a part of the FSS PhD &amp; PostDoc Day event on March 18 2021" />
  

<meta name="author" content="David D’Haese" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
<link rel="prev" href="boxplot.html"/>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/labo.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="1" data-path="boxplot.html"><a href="boxplot.html"><i class="fa fa-check"></i><b>1</b> Boxplot</a>
<ul>
<li class="chapter" data-level="1.1" data-path="boxplot.html"><a href="boxplot.html#start"><i class="fa fa-check"></i><b>1.1</b> Start</a></li>
<li class="chapter" data-level="1.2" data-path="boxplot.html"><a href="boxplot.html#nieuw-project"><i class="fa fa-check"></i><b>1.2</b> Nieuw project</a></li>
<li class="chapter" data-level="1.3" data-path="boxplot.html"><a href="boxplot.html#nieuw-rapport"><i class="fa fa-check"></i><b>1.3</b> Nieuw rapport</a></li>
<li class="chapter" data-level="1.4" data-path="boxplot.html"><a href="boxplot.html#data-opladen"><i class="fa fa-check"></i><b>1.4</b> Data opladen</a></li>
<li class="chapter" data-level="1.5" data-path="boxplot.html"><a href="boxplot.html#woordenschat"><i class="fa fa-check"></i><b>1.5</b> Woordenschat</a></li>
<li class="chapter" data-level="1.6" data-path="boxplot.html"><a href="boxplot.html#departement"><i class="fa fa-check"></i><b>1.6</b> Departement</a></li>
<li class="chapter" data-level="1.7" data-path="boxplot.html"><a href="boxplot.html#de-boxplot"><i class="fa fa-check"></i><b>1.7</b> De boxplot</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tijdreeksen.html"><a href="tijdreeksen.html"><i class="fa fa-check"></i><b>2</b> Tijdreeksen</a>
<ul>
<li class="chapter" data-level="2.1" data-path="tijdreeksen.html"><a href="tijdreeksen.html#inleiding"><i class="fa fa-check"></i><b>2.1</b> Inleiding</a></li>
<li class="chapter" data-level="2.2" data-path="tijdreeksen.html"><a href="tijdreeksen.html#start-1"><i class="fa fa-check"></i><b>2.2</b> Start</a></li>
<li class="chapter" data-level="2.3" data-path="tijdreeksen.html"><a href="tijdreeksen.html#nieuw-project-1"><i class="fa fa-check"></i><b>2.3</b> Nieuw project</a></li>
<li class="chapter" data-level="2.4" data-path="tijdreeksen.html"><a href="tijdreeksen.html#nieuw-rapport-1"><i class="fa fa-check"></i><b>2.4</b> Nieuw rapport</a></li>
<li class="chapter" data-level="2.5" data-path="tijdreeksen.html"><a href="tijdreeksen.html#data-opladen-1"><i class="fa fa-check"></i><b>2.5</b> Data opladen</a></li>
<li class="chapter" data-level="2.6" data-path="tijdreeksen.html"><a href="tijdreeksen.html#kleuren"><i class="fa fa-check"></i><b>2.6</b> Kleuren</a></li>
<li class="chapter" data-level="2.7" data-path="tijdreeksen.html"><a href="tijdreeksen.html#data-exploratie"><i class="fa fa-check"></i><b>2.7</b> Data exploratie</a></li>
<li class="chapter" data-level="2.8" data-path="tijdreeksen.html"><a href="tijdreeksen.html#data-voorbereiden"><i class="fa fa-check"></i><b>2.8</b> Data voorbereiden</a></li>
<li class="chapter" data-level="2.9" data-path="tijdreeksen.html"><a href="tijdreeksen.html#in-grafiek-zetten-van-tijdreeksen"><i class="fa fa-check"></i><b>2.9</b> In grafiek zetten van tijdreeksen</a></li>
<li class="chapter" data-level="2.10" data-path="tijdreeksen.html"><a href="tijdreeksen.html#tijdreeks-analyses"><i class="fa fa-check"></i><b>2.10</b> Tijdreeks analyses</a></li>
<li class="chapter" data-level="2.11" data-path="tijdreeksen.html"><a href="tijdreeksen.html#ontbinden-in-factoren"><i class="fa fa-check"></i><b>2.11</b> Ontbinden in factoren</a></li>
<li class="chapter" data-level="2.12" data-path="tijdreeksen.html"><a href="tijdreeksen.html#voorspellingen"><i class="fa fa-check"></i><b>2.12</b> Voorspellingen</a></li>
<li class="chapter" data-level="2.13" data-path="tijdreeksen.html"><a href="tijdreeksen.html#extra-herbemonsteren-van-temporele-gegevens"><i class="fa fa-check"></i><b>2.13</b> Extra: Herbemonsteren van temporele gegevens</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tijdreeksen</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tijdreeksen" class="section level1" number="2">
<h1><span class="header-section-number">Workshop 2</span> Tijdreeksen</h1>
<div id="inleiding" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Inleiding</h2>
<p>In deze workshop krijg je te zien hoe je temporele data grafisch kunt voorstellen. We zullen zien dat het weergeven van zulke gegevens nauw verweven is met de verwerking ervan. Omdat meeste analyse tools hier ook gebruik van maken zullen we onze gegevens omzetten naar een object van de klasse <code>ts</code> (<em>time series</em>). We gaan ook zien hoe je een voorspelling op tijdreeksen best in grafiek zet.</p>
</div>
<div id="start-1" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Start</h2>
<ol style="list-style-type: decimal">
<li>Indien je dit nog niet eerder hebt gedaan moet je de meest recente stabiele versies van <a href="https://cran.r-project.org/bin/windows/base/">R</a> en <a href="https://rstudio.com/products/rstudio/download/">RStudio</a> downloaden en installeren.</li>
</ol>
</div>
<div id="nieuw-project-1" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Nieuw project</h2>
<p>Je kan ook zonder, maar het is beter om een project-folder te definiëren. Helemaal rechtsboven in RStudio, onder het kruisje om de applicatie te sluiten, vind je een keuzelijst met daarin de mogelijkheid om een nieuw project te creëren.</p>
<ol style="list-style-type: decimal">
<li>Volg de wizard en maak een project aan in een folder naar keuze</li>
</ol>
<p>Het is wel best om voor deze workshop lokaal te werken.</p>
</div>
<div id="nieuw-rapport-1" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Nieuw rapport</h2>
<p>We werken standaard met het principe van elektronische notitieboeken (eng: <em>notebooks</em>). We doen dit om de reproduceerbaarheid te verhogen maar ook gewoon omdat het plezieriger werkt. Het formaat daarvoor is een RMarkdown bestand (extensie `.rmd``). Ga als volgt te werk:</p>
<ol style="list-style-type: decimal">
<li>Maak een nieuw notitieboek aan via de eerste knop linksboven in de knoppenbalk: <em>New File &gt; R Markdown</em></li>
<li>Geef een titel op voor het HTML document. HTML is de standaard keuze maar je merkt dat er veel meer keuze bestaat</li>
<li>Het kan zijn dat RStudio de eerste keer vraagt om een aantal pakketten te downloaden. Antwoord dan ‘ja’ en laat de installatie rustig voltooien</li>
<li>Je merkt dat RStudio een voorbeeld bestandje heeft aangemaakt</li>
<li>Druk nu op de <em>Save</em>-knop of gebruik de sneltoets <code>Ctrl + S</code> om het bestand in de project-folder te bewaren (gebruik de sneltoets <code>Alt + Shift + K</code> voor een overzicht van andere sneltoetsen)</li>
<li>Het bestand gaan we meteen eens <em>uitvoeren</em> of ‘knitten’ door op de knit-knop te drukken of de sneltoets <code>Ctrl + Shift K</code> te gebruiken</li>
</ol>
<p>Als alles goed gaat, wordt er een voorbeeld-rapportje gegenereerd en in de <em>viewer</em>-pane getoond.</p>
</div>
<div id="data-opladen-1" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Data opladen</h2>
<p>Op het einde van de workshop krijg je de kans om met dezelfde dataset als voor de Boxplot-workshop te werken, maar omdat die gegevens zich iets moeilijker lenen voor tijdreeksanalyse, gaan we eerst met een eenvoudigere dataset van start.</p>
<p>Op <a href="https://www.kaggle.com">Kaggle</a> vind je de dataset genaamd
<a href="https://www.kaggle.com/yugagrawal95/timeseries-data">Time Series Data</a>. De data wordt oorspronkelijk als een Excel werkboek beschikbaar wordt gemaakt, maar hier werd dit bestand op voorhand reeds omgezet naar een <code>tsv</code>-bestand. Het bestaat uit de verkoopcijfers van een aantal producten samen met nog een heleboel andere gegevens waar we hier geen gebruik van zullen maken.</p>
<blockquote>
<p>Excel is vaak erg problematisch als databron, dus als je het kan vermijden, gebruik dan het liefst een formaat dat binnen 2000 jaren nog steeds begrepen gaat worden: platte tekst, liefst tab-gescheiden (<code>.tsv</code>, tab-separated values) zodat inhoudelijke komma’s niet ge-escaped moeten worden met dubbele aanhalingstekens.</p>
</blockquote>
<p>Voor het opladen van de data gebruiken we <code>data.table</code>. Dat is op dit ogenblik de meest professionele manier om data te manipuleren. De <code>fread</code> methode is flexibel en laat toe om:</p>
<ul>
<li>zeer snel en zeer grote datasets op te laden</li>
<li>tekst rechtstreeks als data te parseren (i.e. <code>fread("A,B\n1,2\n3,4")</code>)</li>
<li>te bepalen welke variabelen en instanties te selecteren</li>
<li>een shell commando uit te voeren voor de voorbewerking</li>
<li>te bepalen als welke data type de variabelen geïnterpreteerd moeten worden</li>
<li>de tekencodering van een bestand mee te geven (i.e. <code>UTF-8</code>)</li>
<li>de primaire sleutel te definiëren in geval van relationele data</li>
<li>een archiefbestand mee te openen (i.e. <code>fread("dev.gz")</code>)</li>
</ul>
<ol style="list-style-type: decimal">
<li>In je nieuw Rmd bestand, verwijder je de voorbeeld code en plaats je onderstaande code:</li>
</ol>
<pre class="rmd"><code>---
title: &quot;Timeseries&quot;
author: &quot;Jouw naam hier&quot;
date: &quot;Gepubliceerd op 2021-03-15&quot;
output: 
  html_document: 
    highlight: zenburn
---
   
## Workshop tijdreeksen
   
...</code></pre>
<ol style="list-style-type: decimal">
<li>Geef in jouw naam in en vervang <code>...</code> met een nieuwe R codeblok (eng: <em>code chunk</em>) door de drie punjes te selecteren en de sneltoets <code>Ctrl + Alt + I</code> in te geven</li>
<li>Zorg ervoor dat er voor én na elke codeblok, titel en opsomming een lege lijn wordt toegevoegd</li>
<li>Plaats onderstaande code in deze eerste blok (bijkomdende uitleg volgt hieronder):</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="tijdreeksen.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb2-2"><a href="tijdreeksen.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb2-3"><a href="tijdreeksen.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb2-4"><a href="tijdreeksen.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb2-5"><a href="tijdreeksen.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-6"><a href="tijdreeksen.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISOweek)</span>
<span id="cb2-7"><a href="tijdreeksen.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb2-8"><a href="tijdreeksen.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb2-9"><a href="tijdreeksen.html#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="tijdreeksen.html#cb2-10" aria-hidden="true" tabindex="-1"></a>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-11"><a href="tijdreeksen.html#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="tijdreeksen.html#cb2-12" aria-hidden="true" tabindex="-1"></a>sales <span class="ot">&lt;-</span> <span class="fu">fread</span>(, <span class="st">&quot;dat/sales.tsv&quot;</span>)</span></code></pre></div>
<p>Met de verscheidene <code>library</code> uitdrukkingen worden de nodige pakketten in het geheugen geladen. Als deze lijnen een fout genereren, heeft dat er meestal te maken dat het pakket nog niet geïnstalleerd is. Gebruik dan een uitdrukking zoals <code>install.packages(c("data.atble", "magrittr"))</code> in de console om de pakketten te installeren. Hieronder overlopen we kort de reden waarom we deze pakketten laden:</p>
<ul>
<li><code>knitr</code>: parseren van de RMarkdown naar een HTML rapportje</li>
<li><code>data.table</code>: laden en manipuleren van data</li>
<li><code>magrittr</code>: gebruik van <a href="https://en.wikipedia.org/wiki/Method_chaining#:~:text=Method%20chaining%2C%20also%20known%20as,to%20store%20the%20intermediate%20results.">method chaining</a></li>
<li><code>dplyr</code>: alternatief voor het manipuleren van data</li>
<li><code>ISOweek</code>: omzetten van datum naar weeknummers en omgekeerd en dit volgens <a href="https://nl.wikipedia.org/wiki/ISO_8601">ISO 8601</a> normering</li>
<li><code>lubridate</code>: uitdrukken van een datum als decimaal getal</li>
<li><code>forecast</code>: wrapper om voorspellingen uitvoeren op <code>ts</code> objecten</li>
</ul>
<p>Merk op dat hier twee alternatieven worden gebruikt voor het manipuleren van data. Merk ook op dat er veel energie wordt gestoken in het manipuleren van datum velden. Zoals we zullen zien is dat niet voor niets. Het afhandelen van datums, zeker indien de gegevens op weekbasis worden ingedeeld, kan een zeer complexe karwij worden.</p>
<p>Met de <code>opts_chunk$set</code> functie (eigenlijk functie <code>set</code> als element in de <code>list</code> <code>opts_chunk</code>) zorgen we ervoor dat de code mee getoond wordt in het rapport. Wordt het rapport verspreidt naar individuen die aan de code geen boodschap hebben, dan kan je <code>echo = FALSE</code> instellen.</p>
</div>
<div id="kleuren" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Kleuren</h2>
<ol style="list-style-type: decimal">
<li>Maak een kleurenpalet aan:</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="tijdreeksen.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">palette</span>(<span class="fu">c</span>(<span class="fu">rgb</span>(.<span class="dv">7</span>, .<span class="dv">7</span>, .<span class="dv">7</span>), <span class="st">&quot;steelblue1&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;#D3EAF1&quot;</span>))</span></code></pre></div>
<p>De lijn hierboven demonstreert het gebruik van een kleurenpalet. Hier zie je dat je kleuren in verschillende formaten kunt ingeven. Nadat het palet gedefinieerd is, kan je naar de kleuren verwijzen d.m.v. 1, 2, …. Misschien is hier een goede plaats om een zijsprongetje te maken naar de kleurenruimte van <a href="https://en.wikipedia.org/wiki/Munsell_color_system">Munsell</a>.</p>
<blockquote>
<p>Munsell was een genie met kleuren. Een volledige beschrijving van zijn kleurenruimte valt buiten deze workshop, maar het volstaat hier om één van zijn zogenaamde kleurtegenstellingen (dyaden) te bewonderen om waarde ervan in te zien:</p>
</blockquote>
<div class="figure"><span id="fig:munsell"></span>
<img src="img/Dyad_5B-5YR_Annot.png" alt="De dyade blauw-5 tegenover geelrood-5 (5B-5YR). In elke gekleurd vak zie je van boven naar onder een index voor referentie, de Munsell kleurcode, de overeenkomende RGB waarden en ten slotte de kleur voorgesteld als hex triplet. Zie de Wikipedia pagina voor meer info en deze pagina van de Rochester Institute of Technology waar je datasets vindt om gelijkaardige figuren te produceren." width="100%" />
<p class="caption">
Figuur 2.1: De dyade blauw-5 tegenover geelrood-5 (5B-5YR). In elke gekleurd vak zie je van boven naar onder een index voor referentie, de Munsell kleurcode, de overeenkomende RGB waarden en ten slotte de kleur voorgesteld als hex triplet. Zie de <a href="https://en.wikipedia.org/wiki/Munsell_color_system">Wikipedia pagina</a> voor meer info en <a href="https://www.rit.edu/cos/colorscience/rc_munsell_renotation.php">deze pagina</a> van de Rochester Institute of Technology waar je datasets vindt om gelijkaardige figuren te produceren.
</p>
</div>

</div>
<div id="data-exploratie" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Data exploratie</h2>
<p>We gaan de data exploratie hier tot een minimum beperken.</p>
<ol style="list-style-type: decimal">
<li>Met de <code>str</code> functie kijk je naar de inhoud van het <code>sales object</code>. Zulk een functie wordt typisch in de console uitgevoerd en maakt dan geen onderdeel uit van het rapport zelf:</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="tijdreeksen.html#cb4-1" aria-hidden="true" tabindex="-1"></a>sales <span class="sc">%&gt;%</span> str</span></code></pre></div>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   935 obs. of  86 variables:
##  $ Key                                              : chr  &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; ...
##  $ Date                                             : POSIXct, format: &quot;2014-01-01&quot; &quot;2014-01-01&quot; ...
##  $ Volume                                           : num  1346974 677826 1210359 436761 434 ...
##  $ Disc                                             : num  4.29e+08 1.16e+08 1.04e+08 5.63e+07 2.94e+05 ...
##  $ max_T                                            : num  49.5 49.5 49.5 49.5 49.5 ...
##  $ min_T                                            : num  29.7 29.7 29.7 29.7 29.7 ...
##  $ avg_T                                            : num  39.6 39.6 39.6 39.6 39.6 ...
##  $ precipitation                                    : num  0.448 0.448 0.448 0.448 0.448 ...
##  $ Consumer_Price_Index_month                       : num  85.5 85.5 85.5 85.5 85.5 ...
##  $ Exchange_Rate_Index_Period_Average_month         : num  109 109 109 109 109 ...
##  $ Exchange_Rate_LCU_per_US_Period_Average_month    : num  6.83 6.83 6.83 6.83 6.83 ...
...</code></pre>
<p>We zien dat er een aantal producten zijn (onder <code>Key</code>), een datum van verkoop (<code>Date</code>) en dat de verkoopcijfers onder <code>Volume</code> staan. Zoals je kan zien zijn er veel meer variabelen, maar met deze drie zouden we toch al aan de slag moeten kunnen om het principe te demonstreren.</p>
</div>
<div id="data-voorbereiden" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Data voorbereiden</h2>
<p>Het bijzondere aan tijdreeksen (maar ook bijvoorbeeld GIS data) is dat de afhankelijke variabelen niet enkel van andere variabelen afhangt, maar ook van zichzelf. Men spreekt van <em>autocorrelatie</em> wanneer een waarde van een naburige waarde (in ruimte of tijd) afhangt.</p>
<ol style="list-style-type: decimal">
<li>In R werk je bij tijdreeksen het best met <code>ts</code>-klasse objecten (staat voor <em>time series</em>). Daarvoor moeten we eerst de data pivoteren:</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="tijdreeksen.html#cb6-1" aria-hidden="true" tabindex="-1"></a>sales <span class="ot">&lt;-</span> sales <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="tijdreeksen.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dcast</span>(Date <span class="sc">~</span> Key, <span class="at">value.var =</span> <span class="st">&quot;Volume&quot;</span>)</span></code></pre></div>
<div class="table-wrapper">
<table>
<colgroup>
<col width="10%" />
<col width="7%" />
<col width="8%" />
<col width="9%" />
<col width="8%" />
<col width="7%" />
<col width="9%" />
<col width="9%" />
<col width="8%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Date</th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">D</th>
<th align="right">E</th>
<th align="right">F</th>
<th align="right">G</th>
<th align="right">H</th>
<th align="right">I</th>
<th align="right">J</th>
<th align="right">K</th>
<th align="right">L</th>
<th align="right">M</th>
<th align="right">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2014-01-01</td>
<td align="right">1346974</td>
<td align="right">677825.9</td>
<td align="right">1210358.5</td>
<td align="right">436760.7</td>
<td align="right">433.99</td>
<td align="right">1229415.4</td>
<td align="right">790802.1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">2014-02-01</td>
<td align="right">1058681</td>
<td align="right">442605.0</td>
<td align="right">829241.9</td>
<td align="right">205538.3</td>
<td align="right">699.10</td>
<td align="right">885082.1</td>
<td align="right">507910.2</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">2014-03-01</td>
<td align="right">1089615</td>
<td align="right">550634.4</td>
<td align="right">1100553.1</td>
<td align="right">262253.8</td>
<td align="right">1421.69</td>
<td align="right">1191730.8</td>
<td align="right">612966.6</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">2014-04-01</td>
<td align="right">1073261</td>
<td align="right">665210.9</td>
<td align="right">1316461.4</td>
<td align="right">351818.4</td>
<td align="right">1758.77</td>
<td align="right">1357049.5</td>
<td align="right">879226.3</td>
<td align="right">278106.2</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">2014-05-01</td>
<td align="right">1289022</td>
<td align="right">811401.7</td>
<td align="right">1515828.5</td>
<td align="right">309505.0</td>
<td align="right">2275.23</td>
<td align="right">1713073.1</td>
<td align="right">1041092.3</td>
<td align="right">389241.8</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">2014-06-01</td>
<td align="right">1491953</td>
<td align="right">915308.1</td>
<td align="right">1731305.7</td>
<td align="right">339498.8</td>
<td align="right">2894.75</td>
<td align="right">1887919.4</td>
<td align="right">1292278.0</td>
<td align="right">501514.3</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</div>
<p>Dit formaat is eerder uitzonderlijk in statistische analyses en komt men voornamelijk tegen bij gegevens met autocorrelatie (zie ook de term <em>repeated measures</em>).</p>
<ol style="list-style-type: decimal">
<li>Nu selecteren we drie producten en selecteren ze ook op <code>Date</code> om dat er een aantal waarden op het einde van de tijdsreeks ontbreken. Daarna converteren we de data naar een <code>ts</code> object:</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="tijdreeksen.html#cb7-1" aria-hidden="true" tabindex="-1"></a>sales_ts <span class="ot">&lt;-</span> sales[</span>
<span id="cb7-2"><a href="tijdreeksen.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  Date <span class="sc">&lt;</span> <span class="st">&quot;2020-02-01&quot;</span>,    <span class="co"># Selectie op datum</span></span>
<span id="cb7-3"><a href="tijdreeksen.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  .(A, C, E)] <span class="sc">%&gt;%</span>         <span class="co"># Selectie van Variabelen</span></span>
<span id="cb7-4"><a href="tijdreeksen.html#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ts</span>(<span class="at">frequency =</span> <span class="dv">12</span>,    <span class="co"># Omzetten ts, 12 maanden per jaar</span></span>
<span id="cb7-5"><a href="tijdreeksen.html#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2014</span>, <span class="dv">1</span>)) <span class="co"># Startdatum opgeven</span></span></code></pre></div>
</div>
<div id="in-grafiek-zetten-van-tijdreeksen" class="section level2" number="2.9">
<h2><span class="header-section-number">2.9</span> In grafiek zetten van tijdreeksen</h2>
<ol style="list-style-type: decimal">
<li>Vanaf dat alles in het juiste formaat staat is het zo eenvoudig als de plot functie op te roepen:</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="tijdreeksen.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>, <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb8-2"><a href="tijdreeksen.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="tijdreeksen.html#cb8-3" aria-hidden="true" tabindex="-1"></a>main <span class="ot">&lt;-</span> <span class="st">&quot;Verkoopcijfers (volume)</span><span class="sc">\n</span><span class="st">voor drie producten&quot;</span></span>
<span id="cb8-4"><a href="tijdreeksen.html#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="tijdreeksen.html#cb8-5" aria-hidden="true" tabindex="-1"></a>sales_ts <span class="sc">%&gt;%</span> <span class="fu">plot</span>(<span class="at">main =</span> main, <span class="at">xlab =</span> <span class="st">&quot;Jaartal&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Bijna perfect. Er is nog één probleempje met de y-assen. De positie van de labels op assen in <code>base</code> R wordt bepaald door een functie <code>pretty</code>. Je zou dus de y-assen in de plot kunnen uitschakelen (<code>yaxt = "n"</code>) en deze helemaal manueel uittekenen door gebruik te maken van de functie <code>axis</code>, maar het is natuurlijk veel eenvoudiger om de aantallen te delen door een factor 1000.</p>
<ol style="list-style-type: decimal">
<li>Pas de voorgaande code aan om de verkoopcijfers eerst te delen door 1000 en pas ook de titel van de figuur aan:</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="tijdreeksen.html#cb9-1" aria-hidden="true" tabindex="-1"></a>sales_ts_th <span class="ot">&lt;-</span> sales_ts <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb9-2"><a href="tijdreeksen.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="tijdreeksen.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>, <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb9-4"><a href="tijdreeksen.html#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="tijdreeksen.html#cb9-5" aria-hidden="true" tabindex="-1"></a>main <span class="ot">&lt;-</span> <span class="st">&quot;Verkoopcijfers (volume x 1000)</span><span class="sc">\n</span><span class="st">voor drie producten&quot;</span></span>
<span id="cb9-6"><a href="tijdreeksen.html#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="tijdreeksen.html#cb9-7" aria-hidden="true" tabindex="-1"></a>sales_ts_th <span class="sc">%&gt;%</span> <span class="fu">plot</span>(<span class="at">main =</span> main, <span class="at">xlab =</span> <span class="st">&quot;Jaartal&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="tijdreeks-analyses" class="section level2" number="2.10">
<h2><span class="header-section-number">2.10</span> Tijdreeks analyses</h2>
<p>Dit is geen workshop rond analyses, maar in werkelijkheid gaan de analyses en de visualisatie hand-in-hand. Visualisatie is immers vaak ook het in beeld brengen van diagnostieken. Voor tijdreeksen zijn er bijzondere statistieken die de autocorrelatie (binnen eenzelfde variabele) en cross-correlatie (tussen verschillende variabelen) mooi kunnen visualiseren. Hier komt past echt de voordelen van <code>ts</code> naar boven.</p>
<ol style="list-style-type: decimal">
<li>Onderzoek de auto- en cross-correlatie voor alle combinaties van de verkoopvolumes voor de producten A, c en E. Doe dit voor een <em>horizon</em> van 18 maanden in de toekomst (positief) en in het verleden (negatief):</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="tijdreeksen.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>)</span>
<span id="cb10-2"><a href="tijdreeksen.html#cb10-2" aria-hidden="true" tabindex="-1"></a>sales_ts_th <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">lag.max =</span> <span class="dv">18</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Hieruit leren we bijv. dat er een correlatie is tussen producten A en E met een horizon van 1 ‘seizoen’ (1 jaar in dit geval), maar dat de relatie niet volledig symmetrisch is, dus het ene geeft mogelijk aanleiding tot het andere en niet omgekeerd. Om dit te zien vergelijk je de correlatie op 1.0 voor <em>A &amp; E</em> (onder significantie niveau) met die van -1.0 voor <em>E &amp; A</em> (boven significantie niveau).</p>
</div>
<div id="ontbinden-in-factoren" class="section level2" number="2.11">
<h2><span class="header-section-number">2.11</span> Ontbinden in factoren</h2>
<ol style="list-style-type: decimal">
<li>Laten we de verkoopcijfers voor één product, namelijk product C ontbinden in een seizoenseffect (het zuiver repetitief gedeelte), de trend (achtergrond niveau) en de overblijvende ruis:</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="tijdreeksen.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>)</span>
<span id="cb11-2"><a href="tijdreeksen.html#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="tijdreeksen.html#cb11-3" aria-hidden="true" tabindex="-1"></a>sales_ts_th[, <span class="st">&quot;C&quot;</span>] <span class="sc">%&gt;%</span> <span class="fu">stl</span>(<span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span>) <span class="sc">%&gt;%</span> plot</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Merk op dat het probleem van de assen hier wordt opgelost door de positie van de y-as te laten alterneren.</p>
<ol style="list-style-type: decimal">
<li>Onderzoek hoe de plot van een <code>stl</code> object ervoor zorgt dat de assen alternerend getoond worden:</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="tijdreeksen.html#cb12-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">:::</span>plot.stl</span></code></pre></div>
<pre><code>## function (x, labels = colnames(X), set.pars = list(mar = c(0, 
##     6, 0, 6), oma = c(6, 0, 4, 0), tck = -0.01, mfrow = c(nplot, 
##     1)), main = NULL, range.bars = TRUE, ..., col.range = &quot;light gray&quot;) 
## {
##     sers &lt;- x$time.series
##     ncomp &lt;- ncol(sers)
##     data &lt;- drop(sers %*% rep(1, ncomp))
##     X &lt;- cbind(data, sers)
##     colnames(X) &lt;- c(&quot;data&quot;, colnames(sers))
##     nplot &lt;- ncomp + 1
...</code></pre>
</div>
<div id="voorspellingen" class="section level2" number="2.12">
<h2><span class="header-section-number">2.12</span> Voorspellingen</h2>
<p>Laten we toekomst voorspellen, meer bepaald de verkoopcijfers voor het jaar 2019. Merk op dat we die cijfers gewoon hebben, waarom zouden we ze dan voorspellen? Omdat het natuurlijk goed is om meteen de voorspelling te toetsen aan de realiteit, anders moeten we een jaar wachten en dat zagen de organisatoren van deze workshop niet zitten ☺.</p>
<ol style="list-style-type: decimal">
<li>Laten we de standaard plot voor <code>forecast</code> objecten met meerdere variabelen:</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="tijdreeksen.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>)</span>
<span id="cb14-2"><a href="tijdreeksen.html#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="tijdreeksen.html#cb14-3" aria-hidden="true" tabindex="-1"></a>sales_ts_th <span class="sc">%&gt;%</span> forecast <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="tijdreeksen.html#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">col =</span> <span class="dv">3</span>, <span class="at">xlab =</span> <span class="st">&quot;Jaar&quot;</span>,</span>
<span id="cb14-5"><a href="tijdreeksen.html#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Stuks verkocht (x 1000)&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Dit is al vrij goed maar er zijn een aantal problemen. Laten we met een belangrijk detail beginnen: de kleur en de schakeringen van de predictie-intervallen.</p>
<ol style="list-style-type: decimal">
<li>Met <code>fan</code> kan je meer kleurschakeringen bekomen en met <code>colorRampPalette</code> maken we een eenvoudige kleurschakering:</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="tijdreeksen.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>)</span>
<span id="cb15-2"><a href="tijdreeksen.html#cb15-2" aria-hidden="true" tabindex="-1"></a>ramp <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)(<span class="dv">25</span>) </span>
<span id="cb15-3"><a href="tijdreeksen.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="tijdreeksen.html#cb15-4" aria-hidden="true" tabindex="-1"></a>sales_ts_th <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="tijdreeksen.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">fan =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="tijdreeksen.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">col =</span> <span class="dv">3</span>, <span class="at">xlab =</span> <span class="st">&quot;Jaar&quot;</span>, <span class="at">shadecols =</span> ramp,</span>
<span id="cb15-7"><a href="tijdreeksen.html#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Stuks verkocht (x 1000)&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Nu komt het belangrijkste probleem: we willen eigenlijk enkel 2019 voorspellen en we willen de actuele en voorspelde data naast elkaar zien. Het zou ook leuke zijn mocht er een duidelijke markering komen bij de start van de voorspelling.</p>
<ol style="list-style-type: decimal">
<li>Probeer de voorspellingen te reproduceren met hierboven genoemde vereisten:</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="tijdreeksen.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>, <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb16-2"><a href="tijdreeksen.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">2</span>))</span>
<span id="cb16-3"><a href="tijdreeksen.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="tijdreeksen.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(series_name <span class="cf">in</span> sales_ts <span class="sc">%&gt;%</span> colnames) {</span>
<span id="cb16-5"><a href="tijdreeksen.html#cb16-5" aria-hidden="true" tabindex="-1"></a>  series <span class="ot">&lt;-</span> sales_ts_th[, series_name]</span>
<span id="cb16-6"><a href="tijdreeksen.html#cb16-6" aria-hidden="true" tabindex="-1"></a>  fc <span class="ot">&lt;-</span> series <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="tijdreeksen.html#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">window</span>(<span class="at">end=</span><span class="fu">c</span>(<span class="dv">2019</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-8"><a href="tijdreeksen.html#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">forecast</span>(<span class="at">fan =</span> <span class="cn">TRUE</span>, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb16-9"><a href="tijdreeksen.html#cb16-9" aria-hidden="true" tabindex="-1"></a>  fc <span class="sc">%&gt;%</span> <span class="fu">plot</span>(<span class="at">shadecols =</span> ramp, <span class="at">col =</span> <span class="dv">3</span>,</span>
<span id="cb16-10"><a href="tijdreeksen.html#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb16-11"><a href="tijdreeksen.html#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">title</span>(<span class="at">ylab =</span> series_name)</span>
<span id="cb16-12"><a href="tijdreeksen.html#cb16-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-13"><a href="tijdreeksen.html#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (series_name <span class="sc">==</span> <span class="st">&quot;E&quot;</span>) {</span>
<span id="cb16-14"><a href="tijdreeksen.html#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="dv">1</span>)</span>
<span id="cb16-15"><a href="tijdreeksen.html#cb16-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-16"><a href="tijdreeksen.html#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">2019</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb16-17"><a href="tijdreeksen.html#cb16-17" aria-hidden="true" tabindex="-1"></a>  fc <span class="ot">&lt;-</span> series <span class="sc">%&gt;%</span></span>
<span id="cb16-18"><a href="tijdreeksen.html#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">window</span>(<span class="at">start=</span><span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">12</span>)) <span class="sc">%&gt;%</span> <span class="fu">lines</span>(<span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb16-19"><a href="tijdreeksen.html#cb16-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-20"><a href="tijdreeksen.html#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="tijdreeksen.html#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">xlab =</span> <span class="st">&quot;Jaar&quot;</span>, <span class="at">outer =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="extra-herbemonsteren-van-temporele-gegevens" class="section level2" number="2.13">
<h2><span class="header-section-number">2.13</span> Extra: Herbemonsteren van temporele gegevens</h2>
<p>Temporele gegevens zijn vaak georganiseerd op week, maand, kwartaal of jaarbasis. Bijvoorbeeld verkoopcijfers per kwartaal. In het vakjargon spreekt met van een <em>bucket</em> van bijvoorbeeld een week, een kwartaal, enz…. Soms echter, zoals bij onze data, is er wel een datum veld voorzien, maar zijn de data niet netjes geaggregeerd naar zulke vaste tijdseenheid. De aggregatie, die men ook wel <em>resampling</em> of <em>bucketising</em> noemt, moeten we dan nog manueel uitvoeren. Hieronder wordt dit voor de volledigheid gedemonstreerd. We vertrekken van de studenten resultaten data uit Workshop 1:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="tijdreeksen.html#cb17-1" aria-hidden="true" tabindex="-1"></a>sem_1_anon <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;dat/sem_1_anon.tsv&quot;</span>)</span></code></pre></div>
<p>We controleren eerst het bereik van de variabele <code>Datum1</code>, verdelen het al eens in weken en tellen we zeven dagen bij de einddatum:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="tijdreeksen.html#cb18-1" aria-hidden="true" tabindex="-1"></a>sem_1_anon<span class="sc">$</span>Datum1 <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="tijdreeksen.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">range</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="tijdreeksen.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strftime</span>(<span class="st">&quot;%Y-W%V-1&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="tijdreeksen.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  ISOweek2date <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="tijdreeksen.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2020-09-07&quot; &quot;2021-03-08&quot;</code></pre>
<p>Door per week in te kleuren zien we waar er voldoende data aanwezig is om een analyse op uit te voeren:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="tijdreeksen.html#cb20-1" aria-hidden="true" tabindex="-1"></a>sem_1_anon[, Week_T <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(<span class="fu">ISOweek</span>(Datum1))]</span>
<span id="cb20-2"><a href="tijdreeksen.html#cb20-2" aria-hidden="true" tabindex="-1"></a>week_lev_all <span class="ot">&lt;-</span> sem_1_anon<span class="sc">$</span>Week_T <span class="sc">%&gt;%</span> levels</span>
<span id="cb20-3"><a href="tijdreeksen.html#cb20-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-4"><a href="tijdreeksen.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>)</span>
<span id="cb20-5"><a href="tijdreeksen.html#cb20-5" aria-hidden="true" tabindex="-1"></a>ramp <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="dv">24</span>, <span class="dv">1</span>)</span>
<span id="cb20-6"><a href="tijdreeksen.html#cb20-6" aria-hidden="true" tabindex="-1"></a>temp_pal <span class="ot">&lt;-</span> <span class="fu">palette</span>(ramp)</span>
<span id="cb20-7"><a href="tijdreeksen.html#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="tijdreeksen.html#cb20-8" aria-hidden="true" tabindex="-1"></a>sem_1_anon[, <span class="fu">plot</span>(Datum1, MemoS_T, <span class="at">col =</span> Week_T,</span>
<span id="cb20-9"><a href="tijdreeksen.html#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> .<span class="dv">7</span>,</span>
<span id="cb20-10"><a href="tijdreeksen.html#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Indicatie weken&quot;</span>,</span>
<span id="cb20-11"><a href="tijdreeksen.html#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Datum terugblikversie&quot;</span>,</span>
<span id="cb20-12"><a href="tijdreeksen.html#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Memoriseren&quot;</span>)] <span class="ot">-&gt;</span> d</span>
<span id="cb20-13"><a href="tijdreeksen.html#cb20-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-14"><a href="tijdreeksen.html#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> week_lev_all, <span class="at">col =</span> ramp,</span>
<span id="cb20-15"><a href="tijdreeksen.html#cb20-15" aria-hidden="true" tabindex="-1"></a> <span class="at">cex =</span> .<span class="dv">7</span>, <span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">border =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="tijdreeksen.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">palette</span>(temp_pal)</span></code></pre></div>
<p>Nu kunnen we eindelijk een selectie maken + de omzetteing naar <code>ts</code> verzorgen.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="tijdreeksen.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bg =</span> <span class="dv">4</span>)</span>
<span id="cb22-2"><a href="tijdreeksen.html#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="tijdreeksen.html#cb22-3" aria-hidden="true" tabindex="-1"></a>sem_1_anon[</span>
<span id="cb22-4"><a href="tijdreeksen.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">&quot;2020&quot;</span>, Week_T),        <span class="co"># Selectie</span></span>
<span id="cb22-5"><a href="tijdreeksen.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  .(<span class="at">MemoS_T =</span> <span class="fu">mean</span>(MemoS_T)),   <span class="co"># Var-manipulatie</span></span>
<span id="cb22-6"><a href="tijdreeksen.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  Week_T] <span class="sc">%&gt;%</span>                   <span class="co"># Groepering</span></span>
<span id="cb22-7"><a href="tijdreeksen.html#cb22-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(Week_T) <span class="sc">%&gt;%</span>          <span class="co"># dplyr</span></span>
<span id="cb22-8"><a href="tijdreeksen.html#cb22-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(MemoS_T) <span class="sc">%&gt;%</span> </span>
<span id="cb22-9"><a href="tijdreeksen.html#cb22-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ts</span>(</span>
<span id="cb22-10"><a href="tijdreeksen.html#cb22-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq =</span> <span class="fl">365.25</span><span class="sc">/</span><span class="dv">7</span>,</span>
<span id="cb22-11"><a href="tijdreeksen.html#cb22-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">start =</span> <span class="fu">decimal_date</span>(<span class="fu">ymd</span>(<span class="st">&quot;2020-09-07&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="tijdreeksen.html#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">&quot;Tijd (decimaal)&quot;</span>,</span>
<span id="cb22-13"><a href="tijdreeksen.html#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;Memoriseren&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Evolutie memoriseren&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<hr />

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="boxplot.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
